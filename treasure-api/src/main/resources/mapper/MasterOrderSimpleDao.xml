<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.treasure.dao.MasterOrderSimpleDao">


    <select id = "queryByOrder" resultType="io.treasure.entity.OrderSimpleEntity">


        select * from (
                  (
                      select order_id,mo.status,room_id,'good_id',pay_money,reservation_type,eat_time,p_order_id,mo.update_date,cu.head_img
                      from ct_master_order mo
                      left join ct_client_user cu
                      on mo.contact_number = cu.mobile
                      where mo.merchant_id = ${merchantId}
                  )
                  union all
                  select order_id,status,null,good_id,pay_money,null,null,null,update_date,null from ct_slave_order
                  where order_id in (
                      select order_id from ct_master_order
                      where merchant_id = ${merchantId}
                  )
              ) as m_and_s
        where status in(4,6)
        order by update_date
        limit #{index},#{pages};

    </select>

    <select id="qureyCountByMerchantId" resultType="integer">
        select count(0) from (
                  (
                      select order_id,mo.status,room_id,'good_id',pay_money,reservation_type,eat_time,p_order_id,mo.update_date,cu.head_img
                      from ct_master_order mo
                      left join ct_client_user cu
                      on mo.contact_number = cu.mobile
                      where mo.merchant_id = ${merchantId}
                  )
                  union all
                  select order_id,status,null,good_id,pay_money,null,null,null,update_date,null from ct_slave_order
                  where order_id in (
                      select order_id from ct_master_order
                      where merchant_id = ${merchantId}
                  )
              ) as m_and_s
        where status in(4,6)

    </select>


</mapper>


