<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.treasure.dao.OrderRewardWithdrawRecordDao">


    <update id="updateByIds">

        update order_reward_withdraw_reocrd
        set is_used = #{status}
        <where>
            id in
            <foreach collection="ids" item="ids" open="(" close=")" separator=",">
                ${ids}
            </foreach>
        </where>

    </update>

    <update id="updateUsedStatus">

        update order_reward_withdraw_reocrd
        set is_used = ${status}
        where #{stopTime} >= eat_time
    </update>

    <select id="generateSalesRewardRecord" parameterType="io.treasure.vo.MerchantSalesRewardRecordVo" resultType="io.treasure.entity.MerchantSalesRewardRecordEntity">

        select m_id as mId,sum(total_price) as salesVolume, count(*) as orderVolume,platform_income as commissionVolume, 1 as cashOutStatus,0 as deleted
        from order_reward_withdraw_reocrd
        <where>
            is_used = 0
            <if test="minValue != null and minValue != ''">
                and sales_volume >= #{minValue}
            </if>
            <if test="startTime != null and startTime != ''">
                and eat_time >= #{startTime}
            </if>
            <if test="stopTime != null and stopTime != ''">
                and #{stopTime} >= eat_time
            </if>
        </where>
        group by m_id
        order by salesVolume desc, orderVolume desc
        <!--limit #{index},#{pagesNum}-->

    </select>



    <select id="selectCommissionList" resultType="io.treasure.entity.MerchantSalesRewardRecordEntity">

    </select>
    <select id="selectCommissionListByMid" resultType="io.treasure.entity.MerchantSalesRewardRecordEntity">

        select * from order_reward_withdraw_reocrd
        where m_id = #{mId}
        and #{eDate} >= eat_time

--         @Param("mId")Long mId,
--         @Param("sDate")Date sDate,
--         @Param("eDate")Date eDate
    </select>

</mapper>
