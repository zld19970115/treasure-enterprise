<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.treasure.dao.MasterOrderDao">

    <resultMap type="io.treasure.entity.MasterOrderEntity" id="masterOrderMap">

        <result property="id" column="id"/>
        <result property="orderId" column="order_id"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="roomId" column="room_id"/>
        <result property="reservationType" column="reservation_type"/>
        <result property="reservationId" column="reservation_id"/>
        <result property="discountId" column="discount_id"/>
        <result property="eatTime" column="eat_time"/>
        <result property="totalMoney" column="total_money"/>
        <result property="payMoney" column="pay_money"/>
        <result property="status" column="status"/>
        <result property="payMode" column="pay_mode"/>
        <result property="invoice" column="invoice"/>
        <result property="description" column="description"/>
        <result property="payDate" column="pay_date"/>
        <result property="contacts" column="contacts"/>
        <result property="contactNumber" column="contact_number"/>
        <result property="checkStatus" column="check_status"/>
        <result property="checkMode" column="check_mode"/>
        <result property="refundReason" column="refund_reason"/>
        <result property="refundId" column="refund_id"/>
        <result property="refundDate" column="refund_date"/>
        <result property="updateDate" column="update_date"/>
        <result property="createDate" column="create_date"/>
        <result property="creator" column="creator"/>
        <result property="updater" column="updater"/>
    </resultMap>
    <select id="selectByOrderId" resultType="io.treasure.entity.MasterOrderEntity">
        select * from ct_master_order  where order_id=#{orderId}
    </select>
    <select id="listMerchant" parameterType="Map" resultType="io.treasure.dto.MerchantOrderDTO">
        select masterOrder.*,room.name roomName,cuser.head_img userHeadImg from ct_master_order masterOrder
        left join ct_merchant_room room on masterOrder.room_id=room.id
        left join ct_client_user cuser on masterOrder.creator=cuser.id
        where 1=1
        and p_order_id = 0
        <if test="status != null">
            and masterOrder.status in
            <foreach item="item" index="index" collection="statusStr" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="merchantId != null">
            and masterOrder.merchant_id in
            <foreach item="item" index="index" collection="merchantIdStr" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
    </select>
    <select id="selectPOrderId" resultType="io.treasure.entity.MasterOrderEntity">
        select * from ct_master_order where p_order_id = #{orderId} or order_id  = #{orderId}
    </select>
    <update id="updateStatusAndReason" parameterType="io.treasure.entity.MerchantEntity">
        update ct_master_order set status=#{status},updater=#{updater},refund_reason=#{refundReason},
        refund_date=#{refundDate} where id=#{id}
    </update>

    <select id="getOrderByOrderId" parameterType="map" resultType="io.treasure.dto.MasterOrderDTO">
        select *  from ct_master_order where order_id=#{orderId}
    </select>
    <select id="updateOrderStatus" parameterType="io.treasure.entity.MerchantEntity">
        update ct_master_order set  status=#{status}  where order_id=#{orderId} ;
    </select>
    <update id="updatePayMode" parameterType="io.treasure.entity.MasterOrderEntity">
        update ct_master_order set pay_mode=#{payMode} where order_id=#{orderId}
    </update>
    <select id="getOrderById" parameterType="map" resultType="io.treasure.dto.MasterOrderDTO">
        SELECT *  from ct_master_order where id=#{id}
    </select>
    <select id="selectBYPOrderId" resultType="io.treasure.entity.MasterOrderEntity">
          select * from ct_master_order where p_order_id = #{orderId} and status not in (1,9)
    </select>
    <update id="updatePayMoney" parameterType="io.treasure.entity.MasterOrderEntity">
        update ct_master_order set pay_money=#{payMoney} where order_id=#{orderId}
    </update>
    <select id="getRoomOrderByPorderId" resultType="io.treasure.entity.MasterOrderEntity">
        select * from ct_master_order where p_order_id=#{orderId} and  reservation_type=2
    </select>
</mapper>