<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.treasure.dao.MerchantWithdrawDao">

    <resultMap type="io.treasure.entity.MerchantWithdrawEntity" id="merchantWithdrawMap">

        <result property="id" column="id"/>
        <result property="money" column="money"/>
        <result property="type" column="type"/>
        <result property="way" column="way"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="status" column="status"/>
        <result property="remark" column="remark"/>
        <result property="updateDate" column="update_date"/>
        <result property="createDate" column="create_date"/>
        <result property="creator" column="creator"/>
        <result property="updater" column="updater"/>
        <result property="verify" column="verify"/>
        <result property="verifyDate" column="verify_date"/>
        <result property="verifyReason" column="verify_reason"/>
        <result property="verifyState" column="verify_state"/>
    </resultMap>
    <update id="updateStatusById" parameterType="io.treasure.entity.MerchantWithdrawEntity">
        update ct_merchant_withdraw set status=#{status} where id=#{id}
    </update>
    <update id="verify" parameterType="io.treasure.entity.MerchantWithdrawEntity">
        update ct_merchant_withdraw
        set verify_state=#{verifyState},
        verify_reason=#{verifyReason},
        verify_date=#{verifyDate},
        verify=#{verify} ,
        updater=#{verify}
        where id=#{id}
    </update>
    <select id="selectTotalCath" resultType="java.math.BigDecimal">
        SELECT SUM(merchant_proceeds)
        FROM ct_master_order
        WHERE merchant_id = #{martId} AND status IN (2,4,7,10) and check_status = 1
    </select>
    <select id="selectAlreadyCash" resultType="java.lang.Double">
        SELECT SUM(money)   FROM  ct_merchant_withdraw where merchant_id = #{martId} and verify_state= 2
    </select>
    <select id="selectByMartId" resultType="java.lang.Double">
         SELECT SUM(money)   FROM  ct_merchant_withdraw where merchant_id = #{martId} and verify_state in(1,2)
    </select>
    <select id="selectPoByMartID" parameterType="io.treasure.entity.MerchantWithdrawEntity" resultType="io.treasure.entity.MerchantWithdrawEntity">
              SELECT *  FROM  ct_merchant_withdraw where merchant_id = #{martId}
    </select>
    <select id="selectOrderByMartID" resultType="io.treasure.entity.MasterOrderEntity">
        select * from  ct_master_order where 1=1 and merchant_id = #{merchantId}
    </select>
    <select id="listPage" resultType="io.treasure.dto.MerchantWithdrawDTO">
        select draw.*,merchant.name merchantName,user.name userName,user.mobile userMobile,user.username  nickName
        from ct_merchant_withdraw draw
        left join ct_merchant merchant on merchant.id=draw.merchant_id
        left join ct_client_user user on user.id=draw.creator
        where 1=1
        <if test="status != null">
            and draw.status = #{status}
        </if>
        <if test="verifyState != null">
            and draw.verify_state = #{verifyState}
        </if>
        <if test="merchantId != null">
            and draw.merchant_id in
            <foreach item="item" index="index" collection="merchantIdStr" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
    </select>
    <select id="selectWithStatus" resultType="java.lang.String">
select param_value from sys_params where id=1144988823431553026
    </select>

</mapper>