<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.treasure.dao.StatisticsDao">


    <resultMap type="io.treasure.entity.MasterOrderEntity" id="masterOrderMap">

        <result property="id" column="id"/>
        <result property="orderId" column="order_id"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="roomId" column="room_id"/>
        <result property="reservationType" column="reservation_type"/>
        <result property="reservationId" column="reservation_id"/>
        <result property="discountId" column="discount_id"/>
        <result property="eatTime" column="eat_time"/>
        <result property="totalMoney" column="total_money"/>
        <result property="payMoney" column="pay_money"/>
        <result property="status" column="status"/>
        <result property="payMode" column="pay_mode"/>
        <result property="invoice" column="invoice"/>
        <result property="description" column="description"/>
        <result property="payDate" column="pay_date"/>
        <result property="contacts" column="contacts"/>
        <result property="contactNumber" column="contact_number"/>
        <result property="checkStatus" column="check_status"/>
        <result property="checkMode" column="check_mode"/>
        <result property="refundReason" column="refund_reason"/>
        <result property="refundId" column="refund_id"/>
        <result property="refundDate" column="refund_date"/>
        <result property="updateDate" column="update_date"/>
        <result property="createDate" column="create_date"/>
        <result property="creator" column="creator"/>
        <result property="updater" column="updater"/>
    </resultMap>
    <select id="todayOrder" parameterType="io.treasure.entity.MasterOrderEntity" resultType="int">

       select count(*)  from ct_master_order    where  DATE_FORMAT(create_date,'%Y-%m-%d') = #{format} and merchant_id=#{merchantId} and status != "9"
    </select>
    <select id="todayReserve" parameterType="io.treasure.entity.MasterOrderEntity" resultType="int">

       select count(*)  from ct_master_order    where  eat_time > now()  and merchant_id=#{merchantId} and status != "9" and  DATE_FORMAT(create_date,'%Y-%m-%d') = #{format}
    </select>
    <select id="todayQuit" parameterType="io.treasure.entity.MasterOrderEntity" resultType="int">

       select count(*)  from ct_master_order    where  merchant_id=#{merchantId} and status in (4,5,6) and  DATE_FORMAT(create_date,'%Y-%m-%d') = #{format}
    </select>

    <select id="todayMoney" parameterType="io.treasure.entity.MasterOrderEntity" resultType="double">

       select IFNULL(sum(pay_money),0.00) from ct_master_order    where  merchant_id=#{merchantId}  and  DATE_FORMAT(create_date,'%Y-%m-%d') = #{format} and status = "4"
    </select>
    <select id="monthOrder" parameterType="io.treasure.entity.MasterOrderEntity" resultType="int">

       select count(*)  from ct_master_order    where  DATE_FORMAT(create_date,'%Y-%m') = #{month} and merchant_id=#{merchantId} and status != "9"
    </select>

    <select id="monthReserve" parameterType="io.treasure.entity.MasterOrderEntity" resultType="int">

       select count(*)  from ct_master_order    where  eat_time > now()  and merchant_id=#{merchantId} and status != "9" and  DATE_FORMAT(create_date,'%Y-%m') = #{month}
    </select>
    <select id="monthQuit" parameterType="io.treasure.entity.MasterOrderEntity" resultType="int">

       select count(*)  from ct_master_order    where  merchant_id=#{merchantId} and status in (4,5,6) and  DATE_FORMAT(create_date,'%Y-%m') = #{month}
    </select>
    <select id="monthMoney" parameterType="io.treasure.entity.MasterOrderEntity" resultType="double">

       select IFNULL(sum(pay_money),0.00)  from ct_master_order    where  merchant_id=#{merchantId}  and  DATE_FORMAT(create_date,'%Y-%m') = #{month} and status = "4"
    </select>
    <select id="allMoney" parameterType="io.treasure.entity.MasterOrderEntity" resultType="double">

       select IFNULL(sum(pay_money),0.00)  from ct_master_order    where  merchant_id=#{merchantId}   and status = "4"
    </select>
</mapper>