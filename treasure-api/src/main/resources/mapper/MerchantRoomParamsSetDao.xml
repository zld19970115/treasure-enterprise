<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.treasure.dao.MerchantRoomParamsSetDao">

    <resultMap type="io.treasure.entity.MerchantRoomParamsSetEntity" id="merchantRoomParamsSetMap">

        <result property="id" column="id"/>
        <result property="roomParamsId" column="room_params_id"/>
        <result property="roomId" column="room_id"/>
        <result property="type" column="type"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="state" column="state"/>
        <result property="status" column="status"/>
        <result property="remark" column="remark"/>
        <result property="useDate" column="use_date"/>
        <result property="updateDate" column="update_date"/>
        <result property="createDate" column="create_date"/>
        <result property="creator" column="creator"/>
        <result property="updater" column="updater"/>
        <result property="roomName" column="room_name"></result>
    </resultMap>
    <update id="updateStatus" parameterType="io.treasure.entity.MerchantRoomParamsSetEntity">
        update ct_merchant_room_params_set set state=#{status} where id=#{id}
    </update>
    <select id="getAvailableRoomsByData" parameterType="io.treasure.dto.MerchantRoomParamsSetDTO" resultType="java.util.Map">
        SELECT
     	cr.`name`,
        cr.icon,
        cr.type,
        cr.`status`,
        cr.num_low,
        cr.num_high,
        cs.id as set_id,
        cs.room_id,
        cs.state as set_state,
        cs.`status` as set_status,
        cs.room_name
         FROM
	        ct_merchant_room_params_set as cs
	        LEFT JOIN ct_merchant_room AS cr ON cr.id=cs.room_id
        WHERE
	        cs.use_date=#{useDate}
	      AND cs.room_params_id=#{roomParamsId}
	      AND cs.status =1
	      and cr.merchant_id=#{merchantId}
    </select>
</mapper>